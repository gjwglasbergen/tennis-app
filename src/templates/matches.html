{% extends "base.html" %}

{% block content %}
<h1 class="mb-3">Alle wedstrijden</h1>

<div style="max-height: 400px; overflow-y: auto;">
    <table class="table table-striped table-bordered" style="border-collapse: collapse;">
        <thead style="position: sticky; top: 0; background: white; z-index: 2;">
            <tr>
                <th>Date</th>
                <th>Player 1</th>
                <th>Player 2</th>
                <th>Link</th>
                <th>Active</th>
            </tr>
        </thead>
        <tbody id="matchesBody">
            {% for match in matches %}
            <tr id="match-{{ match.id }}">
                <td>{{ match.date_created.strftime("%Y-%m-%d") }}</td>
                <td>{{ match.player1 }}</td>
                <td>{{ match.player2 }}</td>
                <td>
                    <a href="{{ url_for('view_match', match_id=match.id) }}" class="btn btn-sm btn-primary">View</a>
                </td>
                <td class="status-cell">
                    {% if match.active %}
                    <span class="dot bg-success"></span>
                    {% else %}
                    <span class="dot bg-danger"></span>
                    {% endif %}
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="5" class="text-center">No matches yet</td>
            </tr>
            {% endfor %}
        </tbody>
        <tfoot style="position: sticky; bottom: 0; background: white; z-index: 2;">
            <tr>
                <td colspan="5" class="text-center">
                    Totaal wedstrijden: {{ matches|length }}
                </td>
            </tr>
        </tfoot>
    </table>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.1/socket.io.min.js"></script>
<script>
    const socket = io(window.location.origin);

    // Debug
    console.log("Socket.IO connected:", socket);

    socket.on('match_status_updated', (data) => {
        console.log("Update received:", data); // check of het event aankomt

        const row = document.getElementById(`match-${data.match_id}`);
        if (!row) return;

        const statusCell = row.querySelector('.status-cell');
        statusCell.innerHTML = data.is_online
            ? '<span class="dot bg-success"></span>'
            : '<span class="dot bg-danger"></span>';
    });
</script>

{% endblock content %}